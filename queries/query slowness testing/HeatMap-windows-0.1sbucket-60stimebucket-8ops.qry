<?xml version="1.0"?>
<!DOCTYPE plan SYSTEM "queryplan.dtd">

<plan top="tsAtUpdate">

<csvstream id="inputCsvstream"
	file_name="../../JGMtests/data/2nd-half_to_end-5000000.csv"
	attr_names="sid ts x y z v_v v_a vx vy vz ax ay az" 
	attr_types="int TS int int int int int int int int int int int"
/>

<heatmapPreprocessForWindowsGridQuery id="heatmapPreprocessForWindowsGridQuery" input="inputCsvstream"
	xgridattr="x"
	ygridattr="y"
	xcells="16"
	ycells="25"
	corners="0 -33960 52483 33965"
/>

<longBucket id="positionalLongBucket" input="heatmapPreprocessForWindowsGridQuery"
    range="100000000000"
    slide="100000000000"
    wintype="1"
    winattr="ts"
    start="13086639146403495"
/>

<windowCount id="pidCidWidCount" input="positionalLongBucket"
	groupby="$pid $cid $c_midx $c_midy"
	countattr="$x"
	wid="positionalLongBucket"
/>

<expression id="pidCidWidLength" input="pidCidWidCount"
	variables="pidCidWidCount"
	expression="result = (double)pidCidWidCount / 40 * 100000000000L"
/>

<bucket id="temporalBucket" input="pidCidWidLength"
	range="600"
	slide="10"
	wintype="1"
	winattr="wid_from_positionalLongBucket"
	start="0"
/>

<windowLongSum id="locationLongSum" input="temporalBucket"
	groupby="$pid $cid $c_midx $c_midy"
	sumattr="$pidCidWidLength"
	wid="temporalBucket"
/>

<expression id="tsAtUpdate" input="locationLongSum"
	variables="wid_from_temporalBucket"
	expression="result = 13086639146403495L + (wid_from_temporalBucket + 1) * 1000000000000L"
/>

</plan>
